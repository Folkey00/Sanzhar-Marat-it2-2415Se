{% extends 'base.html' %}
{% load static %}

{% block title %}Профиль{% endblock %}

{% block content %}
<div class="card p-4">

    <div class="d-flex align-items-center mb-3">
        {% if user_profile.avatar %}
            <img src="{{ user_profile.avatar.url }}" alt="Аватар" class="rounded-circle me-3" width="100" height="100">
        {% else %}
            <img src="{% static 'img/default-avatar.png' %}" alt="Нет аватара" class="rounded-circle me-3" width="100" height="100">
        {% endif %}

        <div>
            <h3>Профиль: {{ user_profile.username }}</h3>
            <p>Email: {{ user_profile.email }}</p>
            <p>Имя: {{ user_profile.first_name|default:"(не указано)" }}</p>
            <p>Фамилия: {{ user_profile.last_name|default:"(не указано)" }}</p>
        </div>
    </div>

    {% if reviews %}
        <p>Средняя оценка:</p>
        <div class="d-flex align-items-center">
          {% for i in "12345" %}
            {% if forloop.counter <= average_rating|floatformat:"0" %}
              <i class="bi bi-star-fill text-warning fs-5 me-1"></i>
            {% else %}
              <i class="bi bi-star text-muted fs-5 me-1"></i>
            {% endif %}
          {% endfor %}
          <span class="ms-2">({{ average_rating|floatformat:"1" }})</span>
        </div>
    {% else %}
        <p>Пока нет отзывов.</p>
    {% endif %}
</div>

{% if can_review %}
    <a href="{% url 'leave_review' user_profile.id project_id=1 %}" class="btn btn-primary mt-3">Оставить отзыв</a>
{% endif %}

<hr>

<h4>Отзывы:</h4>
{% if reviews %}
    {% for review in reviews %}
        <div class="border p-3 mb-3">
            <p><strong>От:</strong> {{ review.reviewer.username }}</p>
            <p><strong>Проект:</strong> {{ review.project.title }}</p>
            <p><strong>Оценка:</strong> {{ review.rating }} ⭐</p>
            <p><strong>Комментарий:</strong> {{ review.comment }}</p>
        </div>
    {% endfor %}
{% else %}
    <p>Пока нет отзывов.</p>
{% endif %}

<a href="{% url 'dashboard' %}" class="btn btn-secondary mt-3">← На главную</a>
{% endblock %}
